FROM	debian:buster

# To add .env variables
# The var expansion what's going on Dockerfile
ARG	DB_NAME MYSQL_ADMIN_USER MYSQL_ROOT_PASSWORD MYSQL_ADMIN_USER MYSQL_ROOT_PASSWORD MYSQL_USER MYSQL_PASSWORD MYSQL_USER MYSQL_PASSWORD

RUN	apt-get	update \
	&& apt-get install -y mariadb-server

RUN	service mysql start; \
	mysql -e "CREATE DATABASE IF NOT EXISTS ${DB_NAME}; CREATE USER IF NOT EXISTS '${MYSQL_ADMIN_USER}' IDENTIFIED BY '${MYSQL_ROOT_PASSWORD}'; GRANT ALL PRIVILEGES ON *.* TO '${MYSQL_ADMIN_USER}' IDENTIFIED BY '${MYSQL_ROOT_PASSWORD}'; CREATE USER IF NOT EXISTS '${MYSQL_USER}' IDENTIFIED BY '${MYSQL_PASSWORD}'; GRANT ALL PRIVILEGES ON *.* TO '${MYSQL_USER}' IDENTIFIED BY '${MYSQL_PASSWORD}'; FLUSH PRIVILEGES"

COPY	/tools/50-server.cnf etc/mysql/mariadb.conf.d/

#To debug
#ENTRYPOINT ["tail", "-f", "/dev/null"]
CMD	["mysqld"]
